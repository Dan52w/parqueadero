package com.ingsoft.app.service.rol;

import com.ingsoft.app.model.Rol;
import com.ingsoft.app.repository.rol.SqlRol;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

public class ServicioRolConsulta {

    public static void obtenerTodos(javax.servlet.http.HttpServletResponse res) {
        Connection conexion = null;
        try {
            conexion = dbConexion.getConnection();
            PreparedStatement consulta = conexion.prepareStatement(SqlRol.FIND_ALL);
            ResultSet resultado = consulta.executeQuery();

            List<Rol> listaRoles = new ArrayList<>();

            while (resultado.next()) {
                Rol rol = new Rol();
                rol.setCodRol(resultado.getInt("cod_rol"));
                rol.setNombreRol(resultado.getString("nombre_rol"));
                listaRoles.add(rol);
            }

            res.setStatus(200);
            res.getWriter().write(listaRoles.toString()); // Aquí podrías convertir la lista a JSON si quieres

        } catch (Exception e) {
            e.printStackTrace();
            try {
                res.setStatus(400);
                res.getWriter().write("{\"Respuesta\": \"Se totio el SQL mano\"}");
            } catch (Exception ex) {
                ex.printStackTrace();
            }
        } finally {
            if (conexion != null) {
                try {
                    conexion.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
